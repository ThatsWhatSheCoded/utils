#!/usr/bin/env bash

##
# vsh
#
# Create script with name; automatically set file to be executable.
##

readonly ARGS=( "$@" )
readonly PROGNAME=$(basename "${BASH_SOURCE[0]}")
readonly PROGDIR=$(realpath "$(dirname "${BASH_SOURCE[0]}")" )
# readonly NAME=$1

usage() {
	local summary="Create executable script named '<NAME>.<FILETYPE>'"
	local args='<NAME> <FILETYPE> [-h] [-d]'
	local options=(
		"NAME: Script name"
		"FILETYPE: File type. Default: sh"
		"-d: Enable debug mode. Warning: Extremely verbose."
		"-h: Print usage."
	)

	_usage "${summary}" "${PROGNAME}" "${args}" "${options[@]}"
	[[ -n $1 ]] && _err_exit "$@"
	exit -1
}

create_file() {
	local name=${1:?$(_null_var "$FUNCNAME")}

	install -m 755 /dev/null "${name}"
	vim "${name}"
}

check_args() {
	local base=$1
	local ext=$2

	if [[ -z ${base} ]]; then
		usage "Must pass <NAME> arg"
	fi
	filename="${base}.${ext}"
	if [[ -f ${filename} ]]; then
		_err_exit "File '${filename}' already exists"
	fi
}

main() {
	local base=$1
	local ext=${2-'sh'}
	local filename

	source "${PROGDIR}/common.sh"
	_install_dependencies
	_set_colors
	_parse_args "${ARGS[@]}"
	check_args "${base}" "${ext}"
	create_file "${filename}"
}
main "$@"
